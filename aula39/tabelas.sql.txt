CREATE TABLE usuario(
    id_usuario INT PRIMARY KEY AUTO_INCREMENT,
    usuario_nome VARCHAR(100) NOT NULL,
    usuario_email VARCHAR(100) NOT NULL UNIQUE,
    usuario_senha VARCHAR(255) NOT NULL,
    usuario_data_cadastro DATE NOT NULL
);
 
CREATE TABLE conta(
    id_conta INT PRIMARY KEY AUTO_INCREMENT,
    conta_tipo ENUM('corrente', 'poupanca', 'investimento') NOT NULL,
    conta_saldo_atual DECIMAL(15, 2) DEFAULT 0.00,
    id_usuario INT NOT NULL,
    FOREIGN KEY (id_usuario) REFERENCES Usuario(id_usuario)
);
 
CREATE TABLE cartao(
    id_cartao INT PRIMARY KEY AUTO_INCREMENT,
    cartao_numero VARCHAR(16) NOT NULL,
    cartao_validade DATE NOT NULL,
    cartao_limite_credito DECIMAL(15, 2) NOT NULL,
    cartao_bandeira VARCHAR(50) NOT NULL,
    id_usuario INT NOT NULL,
    FOREIGN KEY (id_usuario) REFERENCES usuario(id_usuario)
);
 
CREATE TABLE fatura(
    id_fatura INT PRIMARY KEY AUTO_INCREMENT,
    fatura_data_inicio DATE NOT NULL,
    fatura_data_fim DATE NOT NULL,
    fatura_valor_total DECIMAL(15, 2) NOT NULL,
    fatura_status ENUM('aberta','fechada','paga','atrasada') DEFAULT 'aberta',
    fatura_data_pagamento DATE NULL,
    id_cartao INT NOT NULL,
    FOREIGN KEY (id_cartao) REFERENCES cartao(id_cartao),
    id_conta_pagadora INT NULL,
    FOREIGN KEY (id_conta_pagadora) REFERENCES conta(id_conta)
);
 
CREATE TABLE categoria(
    id_categoria INT PRIMARY KEY AUTO_INCREMENT,
    categoria_nome VARCHAR(100) NOT NULL,
    categoria_pai INT DEFAULT NULL,
    FOREIGN KEY (categoria_pai) REFERENCES categoria(id_categoria)
);
 
CREATE TABLE orcamento(
    id_orcamento INT PRIMARY KEY AUTO_INCREMENT,
    orcamento_valor_total_planejado DECIMAL(15, 2) NOT NULL,
    orcamento_periodo_inicio DATE NOT NULL,
    orcamento_periodo_fim DATE NOT NULL,
    id_usuario INT NOT NULL,
    FOREIGN KEY (id_usuario) REFERENCES usuario(id_usuario)
);
 
CREATE TABLE transacao(
    id_transacao INT PRIMARY KEY AUTO_INCREMENT,
    transacao_valor DECIMAL(10, 2) NOT NULL,
    transacao_data DATE NOT NULL,
    transacao_tipo ENUM('transferencia', 'receita', 'despesa') NOT NULL,
    transacao_descricao VARCHAR(255),
    id_conta INT DEFAULT NULL,
    id_fatura INT DEFAULT NULL,
    id_categoria INT NOT NULL,
    FOREIGN KEY (id_conta) REFERENCES conta(id_conta),
    FOREIGN KEY (id_fatura) REFERENCES fatura(id_fatura),
    FOREIGN KEY (id_categoria) REFERENCES categoria(id_categoria),
    CONSTRAINT chk_origem CHECK ((id_conta IS NOT NULL AND id_fatura IS NULL) OR (id_conta IS NULL AND id_fatura IS NOT NULL)),
    CONSTRAINT chk_receita CHECK (NOT (transacao_tipo = 'receita' AND id_fatura IS NOT NULL))
);

